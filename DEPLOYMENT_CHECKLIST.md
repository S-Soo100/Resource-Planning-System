# 🚀 배포 체크리스트 (Deployment Checklist)

**프로젝트**: KARS v2.5.0 - 고객 상세 페이지
**작성일**: 2026-02-24
**배포 대상**: 프로덕션 환경

---

## ✅ 사전 검증 (Pre-deployment Validation)

### 1. 코드 품질 검증
- [x] **TypeScript 타입 체크 통과** (`npx tsc --noEmit`)
  - ✅ 타입 에러 없음
- [x] **ESLint 경고 해결**
  - ✅ 새로 추가한 코드에서 unused imports 제거
  - ⚠️ 기존 코드 경고는 빌드에 영향 없음 (별도 이슈로 관리)
- [x] **프로덕션 빌드 성공** (`npm run build`)
  - ✅ 빌드 성공
  - ✅ `/supplier/[id]` 페이지 크기: **17.1 kB** (적정)
  - ✅ 총 JS 번들: **109개**
  - ✅ 빌드 디렉토리 크기: **970 MB**

### 2. 기능 테스트
- [ ] **브라우저 테스트** (개발 환경)
  - [ ] Chrome: 고객 상세 페이지 렌더링
  - [ ] Safari: 고객 상세 페이지 렌더링
  - [ ] Firefox: 고객 상세 페이지 렌더링
  - [ ] Mobile (iOS Safari): 반응형 확인
  - [ ] Mobile (Android Chrome): 반응형 확인

- [ ] **핵심 기능 동작 확인**
  - [ ] 고객 기본 정보 표시
  - [ ] 4개 통계 카드 (판매/구매)
  - [ ] 날짜 범위 선택기 (5개 프리셋)
  - [ ] 월별 거래 트렌드 차트
  - [ ] 품목별 TOP 10 분석
  - [ ] 판매 내역 탭 (테이블/카드)
  - [ ] 구매 내역 탭 (테이블/카드)
  - [ ] 엑셀 다운로드 (5개 시트)

- [ ] **권한별 표시 확인**
  - [ ] Admin: 마진 정보 표시
  - [ ] Moderator: 마진 정보 표시
  - [ ] User: 마진 정보 숨김
  - [ ] Supplier: 마진 정보 숨김

### 3. 성능 테스트
- [ ] **Lighthouse 점수**
  - [ ] Performance: ≥ 80
  - [ ] Accessibility: ≥ 90
  - [ ] Best Practices: ≥ 90
  - [ ] SEO: ≥ 90

- [ ] **로딩 시간**
  - [ ] 초기 로딩: < 3초
  - [ ] 날짜 변경 시: < 1초 (캐시 활용)
  - [ ] 탭 전환: < 0.5초

### 4. 데이터 정합성
- [ ] **API 응답 검증**
  - [ ] 고객 정보 정확성
  - [ ] 판매 금액 계산 정확성
  - [ ] 구매 금액 계산 정확성 (실시간 원가)
  - [ ] 월별 집계 정확성
  - [ ] TOP 10 품목 정렬 정확성

- [ ] **엑셀 데이터 검증**
  - [ ] 5개 시트 생성 확인
  - [ ] 데이터 정확성 (판매/구매)
  - [ ] 권한별 컬럼 차별화 (마진)
  - [ ] 한글 깨짐 없음

---

## 📋 배포 절차 (Deployment Steps)

### Step 1: 환경 변수 확인
```bash
# .env.local 파일 확인
cat .env.local

# 필수 환경 변수
# - NEXT_PUBLIC_API_URL
# - NEXT_PUBLIC_ENV
```

### Step 2: 빌드 생성
```bash
# 클린 빌드
rm -rf .next
npm run build

# 빌드 로그 저장
npm run build > build.log 2>&1
```

### Step 3: 배포 전 백업
```bash
# 현재 프로덕션 백업
# (배포 방법에 따라 다름)
```

### Step 4: 배포 실행
```bash
# Vercel 배포 예시
vercel --prod

# 또는 PM2 재시작 (자체 서버)
pm2 restart kars

# 또는 Docker 재배포
docker-compose up -d --build
```

### Step 5: 배포 후 검증
```bash
# Health Check
curl https://your-domain.com/api/health

# 고객 상세 페이지 접근 테스트
curl -I https://your-domain.com/supplier/1
```

---

## 🔍 배포 후 모니터링 (Post-deployment Monitoring)

### 1. 실시간 모니터링 (첫 1시간)
- [ ] **에러 로그 확인**
  - [ ] 서버 에러 로그 확인
  - [ ] 브라우저 콘솔 에러 확인
  - [ ] Sentry/Error Tracking 확인

- [ ] **성능 지표**
  - [ ] 응답 시간: < 500ms (평균)
  - [ ] CPU 사용률: < 70%
  - [ ] 메모리 사용률: < 80%

- [ ] **사용자 피드백**
  - [ ] 초기 사용자 피드백 수집
  - [ ] 버그 리포트 확인

### 2. 1일 후 확인
- [ ] **사용 통계**
  - [ ] 고객 상세 페이지 조회수
  - [ ] 엑셀 다운로드 횟수
  - [ ] 평균 체류 시간

- [ ] **에러 리포트**
  - [ ] 404 에러 없음
  - [ ] 500 에러 없음
  - [ ] API 실패율 < 1%

### 3. 1주일 후 검토
- [ ] **성능 트렌드**
  - [ ] 로딩 시간 추이
  - [ ] API 응답 시간 추이
  - [ ] 에러 발생 추이

- [ ] **사용자 만족도**
  - [ ] 사용자 피드백 분석
  - [ ] 개선 요청 사항 수집

---

## 🔄 롤백 계획 (Rollback Plan)

### 롤백 트리거 (다음 상황 시 즉시 롤백)
1. **크리티컬 버그 발견**
   - 페이지가 로딩되지 않음
   - 데이터 손실 발생
   - 보안 취약점 발견

2. **성능 저하**
   - 응답 시간 > 3초 (지속)
   - CPU/메모리 사용률 > 90%

3. **높은 에러율**
   - 에러율 > 5%
   - API 실패율 > 5%

### 롤백 절차
```bash
# Vercel 롤백 (이전 배포로)
vercel rollback

# 또는 Git 롤백
git revert HEAD
git push origin main

# 또는 PM2 롤백
pm2 reload kars --update-env
```

---

## 📊 배포 완료 보고서 템플릿

```
## 배포 완료 보고

**배포 일시**: YYYY-MM-DD HH:mm:ss
**배포자**: [이름]
**배포 버전**: v2.5.0

### ✅ 배포 내용
- 고객 상세 페이지 신규 추가 (/supplier/[id])
- 날짜 범위 선택기 (5개 프리셋)
- 월별 거래 트렌드 차트
- 품목별 TOP 10 분석
- 엑셀 다운로드 (5개 시트)

### 📈 빌드 정보
- 빌드 시간: [N]분
- 번들 크기: 17.1 kB (supplier/[id])
- 총 JS 번들: 109개
- 빌드 성공 여부: ✅

### 🧪 테스트 결과
- TypeScript: ✅ 통과
- ESLint: ✅ 통과
- 빌드 테스트: ✅ 통과
- 브라우저 테스트: [ ] 진행 중
- 성능 테스트: [ ] 진행 중

### 🐛 발견된 이슈
- 없음 / [이슈 설명]

### 📌 후속 조치
- [ ] 1시간 후 모니터링
- [ ] 1일 후 확인
- [ ] 1주일 후 검토
```

---

## 🔐 보안 체크리스트

### 코드 보안
- [x] **환경 변수 관리**
  - ✅ .env.local은 .gitignore에 포함
  - ✅ API 키 노출 없음

- [x] **권한 검증**
  - ✅ 페이지 접근 시 로그인 체크
  - ✅ 마진 정보는 Admin/Moderator만 표시
  - ✅ 정보 수정 버튼은 Admin/Moderator만 표시

- [x] **데이터 검증**
  - ✅ supplierId 파라미터 검증
  - ✅ 없는 고객 ID 접근 시 에러 핸들링

### API 보안
- [ ] **CORS 설정 확인**
- [ ] **Rate Limiting 확인**
- [ ] **JWT 토큰 만료 처리**

---

## 📝 배포 후 문서 업데이트

### 업데이트 필요 문서
- [x] [CHANGELOG.md](CHANGELOG.md) - v2.5.0 추가
- [x] [docs/supplier-detail.md](docs/supplier-detail.md) - 기능 명세서
- [ ] [README.md](README.md) - 새 기능 소개 (선택)
- [ ] 사용자 가이드 - 고객 상세 페이지 사용법 (선택)

### 버전 관리
- [ ] Git 태그 생성: `git tag v2.5.0`
- [ ] Git 푸시: `git push origin v2.5.0`
- [ ] GitHub Release 생성 (선택)

---

## 📞 긴급 연락망

**배포 담당자**: [이름]
**연락처**: [전화번호]

**백엔드 담당자**: [이름]
**연락처**: [전화번호]

**인프라 담당자**: [이름]
**연락처**: [전화번호]

---

## ✨ 배포 성공 기준

### 필수 조건 (모두 만족 시 배포 성공)
- [x] 빌드 성공
- [ ] 브라우저 테스트 통과 (5개 브라우저)
- [ ] 핵심 기능 동작 확인 (8개 기능)
- [ ] 에러율 < 1%
- [ ] 응답 시간 < 500ms
- [ ] 사용자 피드백 긍정적

### 선택 조건 (권장)
- [ ] Lighthouse 점수 ≥ 80
- [ ] 사용자 만족도 ≥ 4.0/5.0
- [ ] 엑셀 다운로드 성공률 ≥ 95%

---

**체크리스트 작성일**: 2026-02-24
**최종 업데이트**: 2026-02-24
**작성자**: Claude Code
