# KARS - Claude Code ì„¤ì •

## ğŸ“Œ í”„ë¡œì íŠ¸ ê°œìš”
**KARS** (Kangsters Auto Resource-management System) - ë³´ì¡°ê¸°ê¸° ì—…ì²´ìš© í†µí•© ìì› ê´€ë¦¬ ì‹œìŠ¤í…œ

### ê¸°ìˆ  ìŠ¤íƒ
- **í”„ë¡ íŠ¸**: React 18.2 + Next.js 15.1.3 + TypeScript + Tailwind CSS
- **ìƒíƒœ ê´€ë¦¬**: Zustand + React Query (TanStack Query)
- **UI**: Ant Design + Framer Motion

---

## ğŸ¨ ì½”ë”© ê·œì¹™

### ìŠ¤íƒ€ì¼
- React í•¨ìˆ˜í˜• ì»´í¬ë„ŒíŠ¸ + TypeScript strict ëª¨ë“œ
- Tailwind CSS í´ë˜ìŠ¤ ìš°ì„  ì‚¬ìš©

### ëª…ëª… ê·œì¹™
| ëŒ€ìƒ       | ê·œì¹™        | ì˜ˆì‹œ                                |
| ---------- | ----------- | ----------------------------------- |
| ì»´í¬ë„ŒíŠ¸   | PascalCase  | `OrderRequestForm.tsx`              |
| í›…         | camelCase   | `useOrder.ts` (use ì ‘ë‘ì‚¬ í•„ìˆ˜)     |
| íƒ€ì… íŒŒì¼  | kebab-case  | `order-record.ts`                   |

### ëŒ€í™” ê·œì¹™
1. ì¹œê·¼í•œ ë°˜ë§ ì–´íˆ¬
2. ë¶ˆí™•ì‹¤í•œ ë‚´ìš©ì€ ëª…í™•íˆ í‘œì‹œ
3. ë‹¨ê³„ì  ì‚¬ê³  ê³¼ì •ìœ¼ë¡œ ë‹µë³€
4. í•œêµ­ì–´ë¡œ ì‘ë‹µ

---

## ğŸ“š ê¸°ëŠ¥ë³„ ì°¸ì¡° ë¬¸ì„œ
> **ì¤‘ìš”**: ê¸°ëŠ¥ ìˆ˜ì •/í™•ì¥ ì‹œ ë°˜ë“œì‹œ í•´ë‹¹ ë¬¸ì„œë¥¼ ë¨¼ì € í™•ì¸í•  ê²ƒ!

### ğŸ  ë©”ì¸ & UI
| ë¬¸ì„œ                                 | ì£¼ìš” ë‚´ìš©                                 |
| ------------------------------------ | ----------------------------------------- |
| `/docs/menu-tab-state-management.md` | ë©”ì¸ íƒ­ ìƒíƒœ ê´€ë¦¬ (Zustand + localStorage) |

### ğŸ’° íŒë§¤ & êµ¬ë§¤
| ë¬¸ì„œ                           | ì£¼ìš” ë‚´ìš©                                |
| ------------------------------ | ---------------------------------------- |
| `/docs/sales-management.md`    | íŒë§¤ ë‚´ì—­, ê±°ë˜ëª…ì„¸ì„œ, ë¶€ê°€ì„¸(10%), ì—‘ì…€ |
| `/docs/purchase-management.md` | êµ¬ë§¤ ë‚´ì—­, ì›ê°€ ì •ë³´, ì—‘ì…€               |
| `/docs/margin-analysis.md`     | ë§ˆì§„ ë¶„ì„, í’ˆëª©ë³„ ë§ˆì§„ìœ¨, ì—­ë§ˆì§„ ì‹ë³„, ì—‘ì…€ |

### ğŸ“¦ ë°œì£¼ & ì‹œì—°
| ë¬¸ì„œ                               | ì£¼ìš” ë‚´ìš©                              | ì£¼ìš” ê¸°ëŠ¥                            |
| ---------------------------------- | -------------------------------------- | ------------------------------------ |
| `/docs/order-management.md`        | ë°œì£¼ ì›Œí¬í”Œë¡œìš°, ê¶Œí•œ ì œì–´, íœ ì²´ì–´ ë°œì£¼ | ê°€ê²© ì •ë³´(v2.0): VAT ì§ì ‘ ì…ë ¥, ê°€ê²© ìˆ˜ì • ëª¨ë‹¬ |
| `/docs/demonstration-management.md` | ì‹œì—° í”„ë¡œì„¸ìŠ¤, ì¬ê³  ì—°ë™               | ìœ ë£Œ/ë¬´ë£Œ ì‹œì—°, ì¶œê³ /ë³µê·€            |

### ğŸ“Š ì¬ê³  ê´€ë¦¬
| ë¬¸ì„œ                                    | ì£¼ìš” ë‚´ìš©                                  | ë²„ì „  |
| --------------------------------------- | ------------------------------------------ | ----- |
| `/docs/inventory-record-purpose.md`     | recordPurpose í•„ë“œ, ëª©ì ë³„ ì§‘ê³„ í•„í„°ë§     | v2.1  |
| `/docs/inbound-management.md`           | ì…ê³  í”„ë¡œì„¸ìŠ¤ (ì‘ì„± í•„ìš”)                  | -     |
| `/docs/outbound-management.md`          | ì¶œê³  í”„ë¡œì„¸ìŠ¤ (ì‘ì„± í•„ìš”)                  | -     |
| `/docs/inventory-management.md`         | ì¬ê³  í˜„í™© (ì‘ì„± í•„ìš”)                      | -     |

### ğŸ—‚ï¸ ê¸°ì¤€ ì •ë³´
| ë¬¸ì„œ                            | ìƒíƒœ       |
| ------------------------------- | ---------- |
| `/docs/item-management.md`      | ì‘ì„± í•„ìš”  |
| `/docs/warehouse-management.md` | ì‘ì„± í•„ìš”  |
| `/docs/supplier-management.md`  | ì‘ì„± í•„ìš”  |

### ğŸ‘¥ ê´€ë¦¬ì & íŒ€ ê´€ë¦¬
| ë¬¸ì„œ                               | ì£¼ìš” ë‚´ìš©                                        |
| ---------------------------------- | ------------------------------------------------ |
| `/docs/team-members-management.md` | íŒ€ ë©¤ë²„ ê´€ë¦¬, íŒ€ë³„ ê¶Œí•œ ì‹œìŠ¤í…œ, ì°½ê³  ì ‘ê·¼ ì œì–´    |

### ğŸ› ï¸ ê°œë°œ ê°€ì´ë“œ
| ë¬¸ì„œ                            | ì£¼ìš” ë‚´ìš©                                |
| ------------------------------- | ---------------------------------------- |
| `/docs/api-error-handling.md`  | API ì—ëŸ¬ ì²˜ë¦¬ í‘œì¤€ ê°€ì´ë“œ, ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ |

---

## ğŸ”§ í•µì‹¬ ê°œë°œ ê·œì¹™

### API & ë°ì´í„°
- **React Query**: `['resource', params]` í‚¤ êµ¬ì¡°
- **í†µì‹ **: Axios
- **ì¸ì¦**: JWT + Zustand ìƒíƒœ ê´€ë¦¬
- **ìºì‹œ ë¬´íš¨í™”**: ë°ì´í„° ë³€ê²½ í›„ `queryClient.invalidateQueries`ë¡œ ìë™ UI ì—…ë°ì´íŠ¸ (í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ê¸ˆì§€)
- **ì—ëŸ¬ ì²˜ë¦¬**: `/docs/api-error-handling.md` ì°¸ê³  (í‘œì¤€ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì‚¬ìš©)

### ë‚ ì§œ ì²˜ë¦¬
| ê·œì¹™              | ì„¤ëª…                                     |
| ----------------- | ---------------------------------------- |
| ë¹ˆ ê°’             | `undefined` ë°˜í™˜ (ë¹ˆ ë¬¸ìì—´ âŒ)          |
| ì„œë²„ ì „ì†¡         | `undefined` í•„ë“œ ì œê±°                    |
| í˜•ì‹              | `YYYY-MM-DDTHH:MM:SS+09:00` (KST)        |

### ê°€ê²© ì…ë ¥
| ê·œì¹™              | ì„¤ëª…                                     |
| ----------------- | ---------------------------------------- |
| **VAT**           | **ìë™ ê³„ì‚° ê¸ˆì§€** (ì˜ì„¸ìœ¨ 0% í’ˆëª© ì¡´ì¬) |
| íƒ€ì…              | í¼: `string` â†’ ì €ì¥: `number`            |
| ë¹ˆ ê°’             | `undefined` ì „ì†¡ (null âŒ, ë¹ˆ ë¬¸ìì—´ âŒ) |
| ì†Œê³„              | `(íŒë§¤ê°€ + VAT) Ã— ìˆ˜ëŸ‰`                  |
| ê²€ì¦              | `e.target.value.replace(/[^0-9]/g, '')` |

### ê¶Œí•œ ì‹œìŠ¤í…œ

KARSëŠ” **íŒ€ë³„ ê¶Œí•œ ì¤‘ì‹¬ ì•„í‚¤í…ì²˜**ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

#### ê¶Œí•œ ë ˆë²¨
| ë“±ê¸‰       | ê¶Œí•œ                        | í•œê¸€ í‘œì‹œ       |
| ---------- | --------------------------- | --------------- |
| Admin      | ëª¨ë“  ê¸°ëŠ¥ + íŒ€ ê´€ë¦¬ì       | ê´€ë¦¬ì          |
| Moderator  | ì½ê¸° + ë°œì£¼ ìŠ¹ì¸            | 1ì°¨ ìŠ¹ì¸ê¶Œì    |
| User       | ê¸°ë³¸ ê¸°ëŠ¥                   | ì¼ë°˜ ì‚¬ìš©ì     |
| Supplier   | ë°œì£¼ ê´€ë ¨ë§Œ                 | ë‚©í’ˆì²˜          |

#### ê¶Œí•œ ì•„í‚¤í…ì²˜ ì›ì¹™

**íŒ€ ê¶Œí•œ ìš°ì„  (Team-Permission-Centric)**
- `TeamUserMapping.accessLevel` (íŒ€ë³„ ê¶Œí•œ) ìš°ì„  ì‚¬ìš©
- `User.accessLevel` (ê¸°ë³¸ ê¶Œí•œ)ì€ **ë ˆê±°ì‹œ** - ì‹ ê·œ ê°œë°œ ì‹œ ì‚¬ìš© ê¸ˆì§€
- ì‹ ê·œ ì‚¬ìš©ì ìƒì„± ì‹œ ë°˜ë“œì‹œ íŒ€ ê¶Œí•œì„ ìë™ ì„¤ì •í•  ê²ƒ

**isAdmin ìë™ ê³„ì‚°**
- `isAdmin` í•„ë“œëŠ” ë³„ë„ë¡œ ì…ë ¥ë°›ì§€ ì•ŠìŒ
- í•­ìƒ ìë™ ê³„ì‚°: `isAdmin = (accessLevel === "admin")`
- ê´€ë¦¬ì ì„ íƒ ì‹œ isAdmin ìë™ true ì„¤ì •

**3ë‹¨ê³„ ì‚¬ìš©ì ìƒì„± í”Œë¡œìš°**
```typescript
// 1. ì‚¬ìš©ì ìƒì„± (User í…Œì´ë¸”)
const user = await userApi.createUser(userData);

// 2. íŒ€ì— ì¶”ê°€ (TeamUserMapping ìƒì„±)
await teamApi.addUserToTeam(teamId, userId);

// 3. íŒ€ ê¶Œí•œ ì„¤ì • (TeamUserMapping.accessLevel ì„¤ì •) â­ í•„ìˆ˜!
await teamRoleApi.updateTeamRole(teamId, userId, {
  accessLevel: userData.accessLevel,
  isAdmin: userData.accessLevel === "admin",
  restrictedWhs: userData.restrictedWhs,
});
```

**ê¶Œí•œ í‘œì‹œ ìš°ì„ ìˆœìœ„**
```typescript
// íŒ€ ê¶Œí•œì´ ìˆìœ¼ë©´ íŒ€ ê¶Œí•œë§Œ í‘œì‹œ
if (teamUserMapping.accessLevel) {
  return teamUserMapping.accessLevel; // "admin", "moderator", etc.
} else {
  return user.accessLevel; // ê¸°ë³¸ ê¶Œí•œ (ë ˆê±°ì‹œ)
}
```

### í…Œë§ˆ ìƒ‰ìƒ
| ìš©ë„         | ìƒ‰ìƒ                              |
| ------------ | --------------------------------- |
| ì¼ë°˜ ê¸°ëŠ¥    | íŒŒë€ìƒ‰ (`blue-500`, `blue-600`)   |
| íœ ì²´ì–´ ë°œì£¼  | ë³´ë¼ìƒ‰ (`purple-500`, `purple-600`) |
| ê²½ê³ /ì—ëŸ¬    | ë¹¨ê°„ìƒ‰ (`red-500`, `red-600`)     |

### ëª¨ë‹¬ & z-index ê´€ë¦¬
| ë ˆì´ì–´       | z-index | ìš©ë„                              |
| ------------ | ------- | --------------------------------- |
| ê¸°ë³¸ ëª¨ë‹¬    | `z-50`  | SelectSupplierModal ë“± 1ì°¨ ëª¨ë‹¬   |
| ì¤‘ì²© ëª¨ë‹¬    | `z-[60]` | AddSupplierModal ë“± 2ì°¨ ëª¨ë‹¬      |
| ìµœìƒìœ„ ëª¨ë‹¬  | `z-[70]` | ì•Œë¦¼, ê¸´ê¸‰ ë‹¤ì´ì–¼ë¡œê·¸             |

**ê·œì¹™:**
- ëª¨ë‹¬ ìœ„ì— ë‹¤ë¥¸ ëª¨ë‹¬ì´ ì—´ë¦´ ê²½ìš° z-indexë¥¼ 10 ë‹¨ìœ„ë¡œ ì¦ê°€
- ë°±ë“œë¡­ í´ë¦­ ë°©ì§€ê°€ í•„ìš”í•œ ê²½ìš° `e.stopPropagation()` ì‚¬ìš©
- ëª¨ë‹¬ ë‹«ê¸° ì‹œ í•˜ìœ„ ëª¨ë‹¬ë“¤ë„ í•¨ê»˜ ë‹«ê¸°

### ê²€ì¦ ì•„í‚¤í…ì²˜ (3-ë ˆì´ì–´)
í•„ìˆ˜ ë°ì´í„° ê²€ì¦ì€ 3ê°œ ë ˆì´ì–´ì—ì„œ ìˆ˜í–‰:

1. **UI ë ˆì´ì–´**: í¼ ì œì¶œ ì „ ê²€ì¦
   ```typescript
   if (!formData.supplierId) {
     toast.error("ê³ ê°ì„ ì„ íƒí•´ì£¼ì„¸ìš”");
     return false;
   }
   ```

2. **ì„œë¹„ìŠ¤ ë ˆì´ì–´**: ëŸ°íƒ€ì„ ê²€ì¦
   ```typescript
   if (!formData.supplierId) {
     throw new Error("ê³ ê°ì„ ì„ íƒí•´ì£¼ì„¸ìš”");
   }
   ```

3. **íƒ€ì… ì‹œìŠ¤í…œ**: ì»´íŒŒì¼íƒ€ì„ ê²€ì¦
   ```typescript
   interface CreateOrderDto {
     supplierId: number; // nullable ë¶ˆê°€
   }
   ```

### ìë™ ì±„ìš°ê¸° íŒ¨í„´
ì‚¬ìš©ì ê²½í—˜ê³¼ ë°ì´í„° ì •í™•ì„±ì˜ ê· í˜•:

**DO:**
- ì„ íƒ ì‹œ ê´€ë ¨ ì •ë³´ ìë™ ì…ë ¥ (í¸ì˜ì„±)
- ìë™ ì…ë ¥ í›„ ìˆ˜ë™ ìˆ˜ì • í—ˆìš© (ìœ ì—°ì„±)
- í•„ìˆ˜ í•„ë“œëŠ” ëª…í™•íˆ ê²€ì¦ (ì •í™•ì„±)

**DON'T:**
- ìë™ ì…ë ¥ í›„ ìˆ˜ì • ë¶ˆê°€ëŠ¥í•˜ê²Œ ë§Œë“¤ê¸°
- ë¹ˆ ê°’ìœ¼ë¡œ ë®ì–´ì“°ê¸° (ê¸°ì¡´ ì…ë ¥ê°’ ì†ì‹¤)
- ìë™ ì±„ìš°ê¸° ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë°œìƒ

**ì˜ˆì‹œ:**
```typescript
const handleSupplierSelect = (supplier: Supplier) => {
  setFormData({
    ...formData, // ê¸°ì¡´ ë°ì´í„° ìœ ì§€
    supplierId: supplier.id, // í•„ìˆ˜ í•„ë“œ
    receiver: supplier.representativeName || supplier.supplierName || "",
    receiverPhone: supplier.supplierPhoneNumber || "",
    address: supplier.supplierAddress || "",
    detailAddress: "", // ìƒì„¸ì£¼ì†ŒëŠ” ì‚¬ìš©ìê°€ ì§ì ‘ ì…ë ¥
  });
};
```

### ì°½ê³  ì ‘ê·¼ ê¶Œí•œ íŒ¨í„´

**ì§ê´€ì ì¸ ì²´í¬ë°•ìŠ¤ ë¡œì§ (v2.5.0+)**

ì²´í¬ë°•ìŠ¤ëŠ” "ì ‘ê·¼ ê°€ëŠ¥"ì„ ì˜ë¯¸í•˜ë„ë¡ ì„¤ê³„ (ì§ê´€ì„± ìš°ì„ ):

```typescript
// âŒ ì˜ëª»ëœ ë°©ë²• (í—·ê°ˆë¦¼)
// ì²´í¬ = ì ‘ê·¼ ì œí•œ

// âœ… ì˜¬ë°”ë¥¸ ë°©ë²• (ì§ê´€ì )
// ì²´í¬ = ì ‘ê·¼ ê°€ëŠ¥
```

**í”„ë¡ íŠ¸ì—”ë“œ â†’ ë°±ì—”ë“œ ë³€í™˜**

```typescript
// 1. í¼ ìƒíƒœ: ì ‘ê·¼ ê°€ëŠ¥í•œ ì°½ê³  ID ë°°ì—´
const [selectedWarehouses, setSelectedWarehouses] = useState<number[]>([]);

// 2. ì €ì¥ ì‹œ: ì „ì²´ - ì ‘ê·¼ ê°€ëŠ¥ = ì œí•œëœ ì°½ê³ 
const allWarehouseIds = warehouses.map((w) => w.id);
const restrictedIds = allWarehouseIds.filter(
  (id) => !selectedWarehouses.includes(id)
);

// 3. ë°±ì—”ë“œ ì „ì†¡: ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ë¬¸ìì—´
const restrictedWhs = restrictedIds.length > 0 ? restrictedIds.join(",") : "";
```

**ë°±ì—”ë“œ â†’ í”„ë¡ íŠ¸ì—”ë“œ ë³€í™˜**

```typescript
// 1. ë°±ì—”ë“œ ìˆ˜ì‹ : "1,3,5" (ì œí•œëœ ì°½ê³ )
const restrictedWhs = user.restrictedWhs || "";

// 2. íŒŒì‹±
const restrictedIds = restrictedWhs
  .split(",")
  .map((id) => parseInt(id.trim()))
  .filter((id) => !isNaN(id));

// 3. ë³€í™˜: ì „ì²´ - ì œí•œ = ì ‘ê·¼ ê°€ëŠ¥
const allWarehouseIds = warehouses.map((w) => w.id);
const accessibleIds = allWarehouseIds.filter(
  (id) => !restrictedIds.includes(id)
);

// 4. í¼ ìƒíƒœ ì„¤ì •
setSelectedWarehouses(accessibleIds);
```

**ì¼ê´€ì„± ìœ ì§€**
- UserManagementModal: ì‹ ê·œ ì‚¬ìš©ì ìƒì„± ì‹œ
- UserEditModal: ê¸°ì¡´ ì‚¬ìš©ì ì •ë³´ ìˆ˜ì • ì‹œ
- ë‘ ëª¨ë‹¬ ëª¨ë‘ ë™ì¼í•œ ë¡œì§ ì‚¬ìš© (ì ‘ê·¼ ê°€ëŠ¥ â†” ì œí•œ)

---

## âš™ï¸ ì£¼ìš” ëª…ë ¹ì–´

```bash
npm run dev          # ê°œë°œ ì„œë²„ ì‹¤í–‰
npm run build        # í”„ë¡œë•ì…˜ ë¹Œë“œ
npm run type-check   # TypeScript íƒ€ì… ì²´í¬
npm run lint         # ESLint ê²€ì‚¬
```

---

## ğŸ”„ ì—…ë°ì´íŠ¸ ê´€ë¦¬

### ìë™ ì—…ë°ì´íŠ¸ (ê¶Œì¥) ğŸ¤–
`/update-changelog` ìŠ¬ë˜ì‹œ ì»¤ë§¨ë“œ ì‚¬ìš©:

```bash
/update-changelog         # ëŒ€í™”í˜• ëª¨ë“œ
/update-changelog patch   # ë²„ê·¸ ìˆ˜ì • (1.16.1 â†’ 1.16.2)
/update-changelog minor   # ìƒˆ ê¸°ëŠ¥ (1.16.1 â†’ 1.17.0)
/update-changelog major   # ëŒ€ê·œëª¨ ë³€ê²½ (1.16.1 â†’ 2.0.0)
```

**ìë™ ì²˜ë¦¬ í•­ëª©**:
1. âœ… ìµœê·¼ ì»¤ë°‹ ë¶„ì„ & ë³€ê²½ì‚¬í•­ ë¶„ë¥˜
2. âœ… `CHANGELOG.md`ì— ìƒˆ ë²„ì „ ì„¹ì…˜ ì¶”ê°€
3. âœ… `src/constants/version.ts` ë²„ì „ ì—…ë°ì´íŠ¸
4. âœ… `/update` í˜ì´ì§€ ìë™ ìƒì„±

### ìˆ˜ë™ ì—…ë°ì´íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ âœ‹

ë³€ê²½ ì‹œ **ë°˜ë“œì‹œ** ì—…ë°ì´íŠ¸:

- [ ] `CHANGELOG.md` - [Keep a Changelog](https://keepachangelog.com) í˜•ì‹
- [ ] `src/constants/version.ts` - `APP_VERSION` ì—…ë°ì´íŠ¸
- [ ] `/docs` í´ë” ë¬¸ì„œ (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë³€ê²½ ì‹œ)
- [ ] ì»¤ë°‹ ì „ **ë¹Œë“œ í…ŒìŠ¤íŠ¸ í•„ìˆ˜** (`npm run build`)

> âš ï¸ `/update` í˜ì´ì§€ëŠ” ìë™ ìƒì„±ë˜ë¯€ë¡œ ì§ì ‘ ìˆ˜ì • ê¸ˆì§€!